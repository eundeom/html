<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EDUCATION SYSTEM</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-center align-items-center g-2">
        <!-- col more smaller, set size -->
        <div class="col-6">
          <!-- bs5-form-floating -->
          <form action="">
            <!-- bs5-form-select-custom -->
            <div class="mt-3">
              <select class="form-select form-select-lg">
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
              </select>
            </div>
            <div class="form-floating mt-3">
              <input
                type="email"
                class="form-control"
                name="emailInput"
                placeholder=""
                required
              />
              <label for="emailInput">Email</label>
            </div>
            <div class="form-floating mb-3">
              <input
                type="password"
                class="form-control"
                name="passInput"
                placeholder=""
                required
              />
              <label for="passInput">Password</label>
            </div>
            <!-- bs5-form-submit -->
            <button type="submit" class="btn btn-primary mt-2">Login</button>
          </form>
        </div>
      </div>
    </div>
  </body>
  <script type="module">
    import student from "./classes/studentClass.js";
    import teacher from "./classes/teacherClass.js";
    import course from "./classes/courseClass.js";

    let students = [];
    let teachers = [];
    let courses = [];
    let loginStudent = null;
    let loginTeacher = null;
    let loginCourse = null;

    // student data 불러오기
    const httpReq = new XMLHttpRequest();
    httpReq.onload = () => {
      // 200 mean we have a data
      if (httpReq.status == 200) {
        students = JSON.parse(httpReq.response); // load the students data
        onTable();
      }
    };
    httpReq.open("GET", "stList.json", true);
    httpReq.send();

    // teacher data 불러오기
    const httpReqTeacher = new XMLHttpRequest();
    httpReqTeacher.onload = () => {
      if (httpReqTeacher.status == 200) {
        teachers = JSON.parse(httpReqTeacher.response); // load the students data
      }
    };
    httpReqTeacher.open("GET", "teacherList.json", true);
    httpReqTeacher.send();

    // course data 불러오기
    const httpReqCourse = new XMLHttpRequest();
    httpReqCourse.onload = () => {
      if (httpReqCourse.status == 200) {
        courses = JSON.parse(httpReqCourse.response); // load the students data
      }
    };
    httpReqCourse.open("GET", "courseList.json", true);
    httpReqCourse.send();

    // form email과 password 값이 같은지 확인.
    document.querySelector("form").addEventListener("submit", (e) => {
      e.preventDefault();
      let email = document.querySelectorAll("form input")[0].value;
      let pass = document.querySelectorAll("form input")[1].value;

      let selectedOption = document.querySelector("select").value;

      console.log(teachers);
      if (selectedOption == "student") {
        //학생으로 로그인
        for (let stu of students) {
          if (stu.email == email && stu.pass == pass) {
            loginStudent = new student(
              stu.stid,
              stu.fname,
              stu.lname,
              stu.email
            );
            break;
          }
        }
      } else if (selectedOption == "teacher") {
        //선생님으로 로그인
        for (let tch of teachers) {
          if (tch.email == email && tch.pass == pass) {
            console.log(1);
            loginTeacher = new teacher(
              tch.tid,
              tch.fname,
              tch.lname,
              tch.email,
              tch.pass
            );
            break;
          }
        }
      }

      console.log(loginStudent, loginTeacher);
      if (loginStudent != null && loginTeacher == null) {
        // will let the browser to get back to the previous page
        // location.href = "./welcome.html";

        alert(`Hey ${loginStudent.fname} ${loginStudent.lname}`);
        location.replace("./welcome.html"); // will not let the browser to get back to the previous page
        sessionStorage.setItem("u", JSON.stringify(loginStudent));
      } else if (loginTeacher != null && loginStudent == null) {
        alert(`Hey ${loginTeacher.fname} ${loginTeacher.lname}`);
        location.replace("./welcome.html");
        sessionStorage.setItem("t", JSON.stringify(loginTeacher));
      } else {
        alert("USERNAME / PASSWORD is wrong.");
      }
    });
  </script>
</html>
